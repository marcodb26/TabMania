<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Test wantsAttention</title>

		<script>
			window.addEventListener("load", init);

			function toggleTitle() {
				let cnt = 0;
				function titleUpdateCb() {
					let arr = [ "Look at", "me here" ];
					document.title = `Test wantsAttention: [${cnt}] ${arr[cnt % 2]}`;
					cnt++;
					if(cnt < 10) {
						setTimeout(titleUpdateCb, 1000);
					}
				}
				setTimeout(titleUpdateCb, 1000);
			}

			function onClickPopupCb() {
				// The last argument is necessary to create a popup, otherwise Chrome will
				// just open another tab.
				// See https://developer.mozilla.org/en-US/docs/Web/API/Window/open
				let popup = window.open("", null, "resizable,scrollbars,status");
				// "popup" should be non-null
				console.log("The new popup is:", popup);
			}

			function onClickTabNoOpener() {
				let tab = window.open("", null, "noopener");
				// "tab" should be null
				if(tab == null) {
					console.log("The new tab is null, as expected");
				} else {
					console.error("Unexpected, the new tab is not null:", tab);
				}
			}


			function init() {
				toggleTitle();
				document.getElementById("testPopup").addEventListener("click", onClickPopupCb);
				document.getElementById("testNoOpener").addEventListener("click", onClickTabNoOpener);
			}
		</script>
	</head>
	<body>
		<div>
			<h2>Test 1</h2>
			This page runs a script that changes the title of the page every second 10 times, then stops.<br>
			The tabsTitleMonitor "wantsAttention" logic should make the tile of the page go to the top of
			the tiles list while the title changes, starting from the 4th change. The 4th change should be
			cnt == 2:
			<ul>
			<li>1st transition: from page URL to original title in HTML</li>
			<li>2nd transition: from original title, to cnt = 0</li>
			<li>3rd transition: from cnt = 0, to cnt = 1</li>
			<li>4th transition: from cnt = 1, to cnt = 2</li>
			</ul>
			See also comment at TabsTitleMonitor._minTransitionsCountForAttention.<br>
			Then the tile should stay at the top for 10 seconds	(the value of tabsTitleMonitor._timeSensitivity)
			after the title stopped changing, then go back to its standard place in the list.
		</div>

		<hr>

		<div>
			<h2>Test 2</h2>
			If you enable the special actions on page creation (move to least tabbed window, dedup/reuse existing
			tab for URL), TabMania must ignore popup windows. Test the behavior is correct by
			<a href="" id="testPopup">launching a test popup</a>. 
			<h2>Test 3</h2>
			If you enable the special actions on page creation (move to least tabbed window, dedup/reuse existing
			tab for URL), tabs with "noopener" are still expected to have a "tab.openerTabId". We use this property
			to determine if a tab was opened from another tab or from a different application, so it's important to
			continue to validate "tab.openerTabId" remains non-null when "noopener" is used (check the console of
			the background page). Test the behavior is correct by <a href="" id="testNoOpener">launching a "noopener" tab</a>.
			Also, check the console of this page to verify "window.open()" returns "null" (meaning "noopener" is
			working as intended, and yet "tab.openerTabId" is set as needed).
		</div>
	</body>
</html>
